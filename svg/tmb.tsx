import { GestureWrapper } from "@/components/common/GestureWrapper";
import { useUserChoices } from "@/contexts/userChoicesProvider/UserChoicesContextProvider";
import { getMeasurementUnit } from "@/helpers/getMeasurementUnit";
import { MeasurementUnit } from "@/models/measurementUnit";
import React, { useEffect } from "react";
import { useTranslation } from "react-i18next";
import { Image, StyleSheet, Text, View } from "react-native";
import Animated, {
  useAnimatedProps,
  useSharedValue,
  withTiming,
} from "react-native-reanimated";
import Svg, { Path } from "react-native-svg";

export const StickerSmall: React.FC = () => {
  const {
    selectedHike,
    distanceHiked,
    selectedHikeTotalDistance,
    measurementUnit,
    showBorders,
  } = useUserChoices();

  const { t } = useTranslation();

  const AnimatedPath = Animated.createAnimatedComponent(Path);

  const calculatePercentage = () => {
    let newPercentage = 0;
    if (measurementUnit == MeasurementUnit.KILOMETER) {
      newPercentage = Math.round(
        (distanceHiked * 100) / selectedHike?.totalDistanceKilometer!
      );
    } else {
      newPercentage = Math.round(
        (distanceHiked * 100) / selectedHike?.totalDistanceMile!
      );
    }

    return newPercentage;
  };

  const progress = useSharedValue(0);

  const animatedProps = useAnimatedProps(() => {
    const length = selectedHike?.pathLength ?? 0;
    return {
      strokeDashoffset: length - progress.value,
    } as any;
  });

  useEffect(() => {
    if (!selectedHike?.pathLength) return;

    const ratio = Math.max(
      0,
      Math.min(1, distanceHiked / selectedHikeTotalDistance)
    );

    progress.value = 0;
    progress.value = withTiming(ratio * selectedHike.pathLength, {
      duration: 2000,
    });
  }, [distanceHiked, selectedHikeTotalDistance, selectedHike?.pathLength]);

  return (
    <GestureWrapper>
      <View style={styles.container}>
        <View style={styles.statsContainer}>
          <Image
            source={{ uri: selectedHike?.logo }}
            style={{ width: 40, height: 40 }}
          />
          <Text style={styles.percentage}>Pacific Crest Trail</Text>
          <Text style={styles.label}>{t("index:sticker.total")}</Text>
          <Text style={styles.value}>
            {selectedHikeTotalDistance} {getMeasurementUnit(measurementUnit)}
          </Text>
          <Text style={styles.label}>{t("index:sticker.distanceHiked")}</Text>
          <Text style={styles.value}>
            {distanceHiked} {getMeasurementUnit(measurementUnit)}
          </Text>
        </View>
        <Svg width={120} height={220} viewBox="0 0 711 767" fill="none">
          {showBorders && (
            <>
              <Path
                d={
                  "M420.326 44.2131C420.326 43.4318 420.068 42.84 419.552 42.4375C419.036 42.0303 418.338 41.8267 417.457 41.8267C416.813 41.8267 416.233 41.9309 415.717 42.1392C415.201 42.3476 414.779 42.634 414.453 42.9986C414.126 43.3632 413.925 43.7775 413.849 44.2415C413.788 44.6298 413.828 44.9636 413.97 45.2429C414.112 45.5175 414.313 45.7472 414.573 45.9318C414.839 46.1118 415.123 46.2609 415.426 46.3793C415.729 46.4929 416.008 46.5852 416.264 46.6563L417.684 47.054C418.039 47.1534 418.435 47.2907 418.87 47.4659C419.306 47.6411 419.713 47.8802 420.092 48.1833C420.471 48.4816 420.76 48.8651 420.958 49.3338C421.162 49.8026 421.207 50.3779 421.093 51.0597C420.961 51.8457 420.636 52.5559 420.12 53.1904C419.609 53.8248 418.932 54.3291 418.089 54.7031C417.251 55.0772 416.273 55.2642 415.156 55.2642C414.114 55.2642 413.238 55.0961 412.528 54.76C411.823 54.4238 411.302 53.955 410.966 53.3537C410.634 52.7524 410.506 52.054 410.582 51.2585H412.4C412.353 51.8078 412.462 52.2623 412.727 52.6222C412.992 52.9773 413.361 53.2424 413.835 53.4176C414.308 53.5881 414.834 53.6733 415.412 53.6733C416.084 53.6733 416.704 53.5644 417.272 53.3466C417.845 53.1241 418.319 52.8163 418.693 52.4233C419.072 52.0256 419.304 51.5616 419.389 51.0313C419.474 50.5483 419.408 50.1553 419.19 49.8523C418.972 49.5493 418.657 49.3031 418.245 49.1137C417.833 48.9243 417.381 48.7585 416.889 48.6165L415.184 48.1051C414.105 47.7784 413.283 47.312 412.72 46.706C412.161 46.0999 411.96 45.3068 412.116 44.3267C412.258 43.5123 412.601 42.8021 413.146 42.196C413.69 41.5852 414.365 41.1118 415.17 40.7756C415.975 40.4347 416.841 40.2642 417.77 40.2642C418.707 40.2642 419.51 40.4347 420.177 40.7756C420.845 41.1118 421.342 41.5781 421.669 42.1747C421.995 42.7666 422.116 43.446 422.031 44.2131H420.326ZM425.978 55.0085L424.415 40.4631H426.205L427.285 52.3097H427.427L432.484 40.4631H434.472L435.609 52.3097H435.751L440.751 40.4631H442.54L436.148 55.0085H434.33L433.052 43.4176H432.938L427.796 55.0085H425.978ZM446.496 40.4631L444.082 55.0085H442.32L444.735 40.4631H446.496ZM448.977 42.0256L449.233 40.4631H460.142L459.886 42.0256H455.312L453.153 55.0085H451.392L453.551 42.0256H448.977ZM459.962 55.0085L460.19 53.7301L469.962 42.0256H462.036L462.292 40.4631H472.32L472.121 41.7415L462.32 53.446H470.246L469.991 55.0085H459.962ZM472.945 55.0085L475.36 40.4631H484.138L483.883 42.0256H476.866L476.042 46.9404H482.604L482.349 48.5029H475.786L474.962 53.446H482.093L481.837 55.0085H472.945ZM484.898 55.0085L487.313 40.4631H492.228C493.364 40.4631 494.264 40.6549 494.927 41.0384C495.594 41.4219 496.047 41.9498 496.283 42.6222C496.525 43.2945 496.575 44.0616 496.433 44.9233C496.29 45.7756 495.987 46.5332 495.523 47.196C495.064 47.8589 494.439 48.3798 493.648 48.7585C492.862 49.1373 491.906 49.3267 490.779 49.3267H486.802L487.086 47.7358H491.006C491.783 47.7358 492.427 47.6222 492.938 47.3949C493.45 47.1676 493.847 46.8433 494.131 46.4219C494.415 46.0005 494.605 45.501 494.7 44.9233C494.794 44.3362 494.768 43.8272 494.621 43.3963C494.479 42.9607 494.188 42.6245 493.748 42.3878C493.312 42.1463 492.701 42.0256 491.915 42.0256H488.819L486.66 55.0085H484.898ZM492.825 48.4745L495.325 55.0085H493.279L490.836 48.4745H492.825ZM497.691 55.0085L500.106 40.4631H501.868L499.708 53.446H506.47L506.214 55.0085H497.691ZM510.456 55.0085H508.609L516.365 40.4631H518.183L521.109 55.0085H519.263L516.962 42.7642H516.848L510.456 55.0085ZM512.075 49.3267H519.518L519.263 50.8892H511.82L512.075 49.3267ZM537.324 40.4631L534.909 55.0085H533.205L527.182 43.5881H527.04L525.136 55.0085H523.375L525.79 40.4631H527.494L533.545 51.912H533.687L535.591 40.4631H537.324ZM542.979 55.0085H538.434L540.848 40.4631H545.479C546.89 40.4631 548.052 40.759 548.966 41.3509C549.885 41.9427 550.524 42.7879 550.884 43.8864C551.248 44.9849 551.303 46.2964 551.047 47.821C550.801 49.3173 550.323 50.6028 549.613 51.6776C548.907 52.7477 547.993 53.5715 546.871 54.1492C545.754 54.7221 544.456 55.0085 542.979 55.0085ZM540.458 53.446H543.036C544.238 53.446 545.275 53.2093 546.147 52.7358C547.023 52.2623 547.728 51.5876 548.263 50.7117C548.803 49.8357 549.172 48.7964 549.371 47.5938C549.57 46.4385 549.551 45.4465 549.314 44.6179C549.082 43.7846 548.625 43.1454 547.944 42.7003C547.266 42.2505 546.36 42.0256 545.223 42.0256H542.347L540.458 53.446Z"
                }
                stroke="white"
                strokeWidth={2}
              />
              <Path
                stroke="white"
                strokeWidth={2}
                d={
                  "M499.038 673.209L496.623 687.754H494.862L497.277 673.209H499.038ZM501.518 674.771L501.774 673.209H512.683L512.427 674.771H507.854L505.695 687.754H503.933L506.092 674.771H501.518ZM511.884 687.754H510.038L517.793 673.209H519.611L522.538 687.754H520.691L518.39 675.51H518.276L511.884 687.754ZM513.503 682.072H520.947L520.691 683.635H513.248L513.503 682.072ZM524.803 687.754L527.218 673.209H528.979L526.82 686.192H533.582L533.326 687.754H524.803ZM536.534 673.209H538.551L541.478 679.998H541.648L546.79 673.209H548.807L542.131 681.76L541.137 687.754H539.375L540.37 681.76L536.534 673.209Z"
                }
              />
              <Path
                stroke="white"
                strokeWidth={2}
                d={
                  "M468.338 344.655C459.625 326.424 479.93 298.604 462.073 293.279C444.216 287.953 431.998 281.375 430.432 269.471C428.866 257.566 444.216 253.494 444.216 253.494C434.852 228.954 430.423 221.597 424.166 220.601C415.505 224.509 410.63 222.267 401.924 214.962C403.818 204.047 403.04 198.161 396.285 188.334C382.722 180.365 377.887 175.249 373.416 165.152L364.644 141.031C355.976 143.757 352.153 142.364 348.041 132.259C351.954 120.813 350.821 119.447 348.041 118.162C335.234 115.57 329.555 123.755 319.846 141.031C305.537 143.367 299.483 151.369 296.977 154.188C294.47 157.007 281.313 148.862 279.746 141.031C278.18 133.199 283.506 112.523 288.205 109.391C292.904 106.258 294.47 108.138 296.977 103.125C299.483 98.113 294.784 80.57 292.591 69.6057C290.398 58.6413 308.568 31.0737 310.761 25.7482C312.954 20.4226 273.481 31.7002 269.095 25.7482C264.709 19.7961 253.431 14.7838 244.346 12.5909C235.261 10.398 219.911 19.7961 214.585 16.9767C209.259 14.1572 195.789 1 195.789 1M468.338 344.655C468.338 344.655 455.181 344.655 444.216 355.932C433.251 367.21 428.239 375.042 424.166 381.934C420.094 388.826 425.733 386.006 426.359 396.657C426.986 407.308 421.66 429.55 413.202 429.55C404.743 429.55 399.731 419.839 390.959 429.55C382.188 439.262 370.91 437.069 365.897 441.455C360.885 445.84 359.318 459.311 354.306 463.383C349.294 467.456 349.607 474.348 343.028 467.456C336.449 460.564 332.063 465.263 332.063 465.263C332.063 465.263 329.871 469.649 321.412 471.842C312.954 474.034 298.856 457.744 288.831 460.564C278.807 463.383 283.506 484.999 271.601 486.565C259.697 488.131 254.998 474.348 238.081 477.794C221.164 481.24 215.525 492.517 215.525 492.517C215.525 492.517 199.861 505.361 207.693 516.012C215.525 526.663 230.875 540.76 215.525 546.399C200.174 552.038 199.968 581.176 203.62 585.244C207.272 589.313 203.934 617.198 205.813 623.463C207.693 629.729 213.332 621.897 215.525 632.861C217.718 643.826 210.496 638.864 207.693 655.416C204.891 671.969 237.606 702.613 241.84 697.708C252.387 720.099 277.867 734.987 287.265 729.348C296.663 723.709 297.29 725.902 309.821 729.348C322.352 732.794 311.701 748.457 312.954 755.036C314.207 761.614 327.678 766 327.678 766M468.338 344.655C468.338 344.655 475.857 358.125 481.183 355.932C486.508 353.74 489.328 361.885 490.581 367.21C491.834 372.536 489.641 375.668 490.581 378.801C491.521 381.934 500.919 383.5 503.738 388.826C506.558 394.151 508.751 404.176 514.077 407.308C519.402 410.441 522.848 412.634 525.981 417.646C529.114 422.658 519.716 421.719 525.981 429.55C532.247 437.382 524.101 438.322 532.873 445.84C541.645 453.359 565.767 434.249 565.767 434.249C565.767 434.249 574.539 416.393 588.636 414.827C602.734 413.26 603.36 417.646 603.36 417.646C603.36 417.646 599.288 420.779 600.227 425.165C601.167 429.55 617.771 437.382 617.771 437.382C628.264 447.145 633.66 448.177 641.893 437.382C638.718 432.151 638.76 420.466 641.893 417.646C645.026 414.827 655.076 412.212 660.69 404.489C656.24 395.423 661.789 394.3 673.534 393.211C682.833 396.93 695.15 386.006 697.343 393.211C699.536 400.416 709.247 396.657 709.247 396.657"
                }
              />
              <Path
                stroke="white"
                strokeWidth={6}
                d={
                  "M0.852273 191.153L3.26705 176.607H11.9886L11.733 178.17H4.77273L3.94886 183.084H10.2557L10 184.647H3.69318L2.61364 191.153H0.852273ZM12.5906 191.153L15.0053 176.607H19.9201C21.0565 176.607 21.9561 176.799 22.619 177.182C23.2866 177.566 23.7388 178.094 23.9755 178.766C24.217 179.439 24.2667 180.206 24.1246 181.067C23.9826 181.92 23.6796 182.677 23.2156 183.34C22.7563 184.003 22.1313 184.524 21.3406 184.903C20.5546 185.281 19.5981 185.471 18.4712 185.471H14.494L14.7781 183.88H18.6985C19.475 183.88 20.119 183.766 20.6303 183.539C21.1417 183.312 21.5394 182.987 21.8235 182.566C22.1076 182.145 22.297 181.645 22.3917 181.067C22.4864 180.48 22.4603 179.971 22.3136 179.54C22.1715 179.105 21.8803 178.769 21.44 178.532C21.0044 178.29 20.3936 178.17 19.6076 178.17H16.511L14.3519 191.153H12.5906ZM20.5167 184.618L23.0167 191.153H20.9712L18.5281 184.618H20.5167ZM25.9801 191.153H24.1335L31.8892 176.607H33.7074L36.6335 191.153H34.7869L32.4858 178.908H32.3722L25.9801 191.153ZM27.5994 185.471H35.0426L34.7869 187.033H27.3438L27.5994 185.471ZM52.848 176.607L50.4332 191.153H48.7287L42.706 179.732H42.5639L40.6605 191.153H38.8991L41.3139 176.607H43.0185L49.0696 188.056H49.2116L51.1151 176.607H52.848ZM67.31 181.153H65.5771C65.5581 180.646 65.454 180.201 65.2646 179.817C65.0752 179.434 64.8195 179.112 64.4975 178.851C64.1803 178.586 63.8157 178.387 63.4038 178.255C62.9918 178.122 62.5515 178.056 62.0827 178.056C61.1831 178.056 60.3308 178.286 59.5259 178.745C58.721 179.199 58.0321 179.869 57.4592 180.755C56.8862 181.636 56.4956 182.715 56.2873 183.993C56.079 185.234 56.1097 186.278 56.3796 187.126C56.6495 187.973 57.0969 188.615 57.7219 189.05C58.3469 189.486 59.0903 189.704 59.9521 189.704C60.4492 189.704 60.9369 189.637 61.4151 189.505C61.8981 189.372 62.3479 189.176 62.7646 188.915C63.186 188.65 63.56 188.326 63.8867 187.942C64.2182 187.554 64.4786 187.109 64.668 186.607H66.4293C66.1689 187.351 65.8162 188.016 65.3711 188.603C64.9308 189.19 64.4218 189.69 63.8441 190.101C63.2665 190.509 62.6438 190.819 61.9762 191.032C61.3086 191.245 60.6149 191.351 59.8952 191.351C58.6358 191.351 57.5633 191.044 56.6779 190.428C55.7972 189.808 55.1675 188.932 54.7887 187.8C54.4147 186.664 54.3555 185.319 54.6112 183.766C54.8668 182.251 55.3569 180.944 56.0813 179.846C56.8058 178.743 57.6935 177.895 58.7447 177.303C59.7958 176.707 60.9369 176.408 62.168 176.408C62.9066 176.408 63.5861 176.515 64.2063 176.728C64.8266 176.941 65.3664 177.253 65.8256 177.665C66.2849 178.073 66.6424 178.57 66.8981 179.157C67.1585 179.739 67.2958 180.404 67.31 181.153ZM68.5085 191.153L70.9233 176.607H79.7017L79.446 178.17H72.429L71.6051 183.084H78.1676L77.9119 184.647H71.3494L70.5256 189.59H77.6562L77.4006 191.153H68.5085Z"
                }
              />
            </>
          )}
          <Path
            d={
              "M193.639 395.249C200.4 391.133 196.297 377.2 201.293 373.445C206.289 369.691 220.394 368.314 228.46 353.419C236.141 318.526 257.187 310.237 269.99 305.231C282.793 300.225 275.584 282.97 278.733 284.579C278.733 284.579 290.911 290.836 294.346 284.579C297.781 278.321 311.041 250.165 338.999 221.996C343.482 221.503 369.622 173.148 371.787 173.808C373.951 174.468 382.403 180.692 390.522 177.563C398.641 174.434 416.44 149.401 415.502 137.197C414.565 124.994 475.456 123.742 478.579 132.191C481.702 140.639 472.958 141.578 474.207 146.585C475.457 151.591 478.579 154.095 483.575 151.591C488.571 149.088 495.128 135.32 500.125 137.197C505.121 139.075 525.73 158.162 526.667 165.985C527.604 173.808 546.026 171.931 551.023 177.563C556.02 183.195 543.997 195.714 551.023 203.222C556.156 198.979 561.278 243.09 557.58 254.226C553.883 265.362 547.9 251.723 543.841 254.226C539.782 256.729 531.35 307.734 526.667 312.428C521.983 317.121 529.164 352.48 526.667 360.616C524.169 368.752 545.402 372.194 543.841 380.642C542.28 389.091 507.292 392.778 492.943 405.049C484.107 414.329 479.892 419.687 483.575 431.647C464.4 457.625 454.289 470.348 439.859 482.651C418.09 491.197 408.478 497.693 396.767 513.003C393.666 519.221 395.443 523.305 403.949 531.465C403.949 531.465 401.451 541.478 390.522 545.859C379.593 550.24 380.842 567.137 376.783 559.627C372.723 552.117 357.433 544.609 348.055 550.24C305.988 587.623 295.75 594.132 294.346 587.476C288.85 578.941 284.707 576.281 274.362 577.463C250.106 584.273 240.345 588.198 237.827 595.612C201.654 614.991 187.014 625.304 175.375 642.236C171.108 642.838 116.858 723.696 119.481 701.063C122.104 678.429 93.8758 640.984 95.1248 638.481C96.3739 635.977 107.253 629.986 106.678 624.4C95.4932 616.064 93.5647 612.759 95.1248 608.441C110.36 594.544 98.6077 562.01 100.745 559.627C115.069 543.659 119.202 511.117 115.109 504.868C111.017 498.618 111.749 469.221 119.481 467.631H134.47C128.052 453.217 126.573 448.585 126.663 444.789C131.28 438.812 134.54 435.928 151.019 438.218C156.375 438.075 157.417 410.894 156.168 406.514C154.919 402.133 173.342 396.813 173.342 396.813"
            }
            stroke="#D5D5D5"
            strokeWidth={12}
          />
          <AnimatedPath
            d={
              "M193.639 395.249C200.4 391.133 196.297 377.2 201.293 373.445C206.289 369.691 220.394 368.314 228.46 353.419C236.141 318.526 257.187 310.237 269.99 305.231C282.793 300.225 275.584 282.97 278.733 284.579C278.733 284.579 290.911 290.836 294.346 284.579C297.781 278.321 311.041 250.165 338.999 221.996C343.482 221.503 369.622 173.148 371.787 173.808C373.951 174.468 382.403 180.692 390.522 177.563C398.641 174.434 416.44 149.401 415.502 137.197C414.565 124.994 475.456 123.742 478.579 132.191C481.702 140.639 472.958 141.578 474.207 146.585C475.457 151.591 478.579 154.095 483.575 151.591C488.571 149.088 495.128 135.32 500.125 137.197C505.121 139.075 525.73 158.162 526.667 165.985C527.604 173.808 546.026 171.931 551.023 177.563C556.02 183.195 543.997 195.714 551.023 203.222C556.156 198.979 561.278 243.09 557.58 254.226C553.883 265.362 547.9 251.723 543.841 254.226C539.782 256.729 531.35 307.734 526.667 312.428C521.983 317.121 529.164 352.48 526.667 360.616C524.169 368.752 545.402 372.194 543.841 380.642C542.28 389.091 507.292 392.778 492.943 405.049C484.107 414.329 479.892 419.687 483.575 431.647C464.4 457.625 454.289 470.348 439.859 482.651C418.09 491.197 408.478 497.693 396.767 513.003C393.666 519.221 395.443 523.305 403.949 531.465C403.949 531.465 401.451 541.478 390.522 545.859C379.593 550.24 380.842 567.137 376.783 559.627C372.723 552.117 357.433 544.609 348.055 550.24C305.988 587.623 295.75 594.132 294.346 587.476C288.85 578.941 284.707 576.281 274.362 577.463C250.106 584.273 240.345 588.198 237.827 595.612C201.654 614.991 187.014 625.304 175.375 642.236C171.108 642.838 116.858 723.696 119.481 701.063C122.104 678.429 93.8758 640.984 95.1248 638.481C96.3739 635.977 107.253 629.986 106.678 624.4C95.4932 616.064 93.5647 612.759 95.1248 608.441C110.36 594.544 98.6077 562.01 100.745 559.627C115.069 543.659 119.202 511.117 115.109 504.868C111.017 498.618 111.749 469.221 119.481 467.631H134.47C128.052 453.217 126.573 448.585 126.663 444.789C131.28 438.812 134.54 435.928 151.019 438.218C156.375 438.075 157.417 410.894 156.168 406.514C154.919 402.133 173.342 396.813 173.342 396.813"
            }
            stroke="#FC5200"
            strokeWidth={12}
            fill="none"
            strokeDasharray={selectedHike?.pathLength}
            animatedProps={animatedProps}
          />
        </Svg>
      </View>
    </GestureWrapper>
  );
};

const styles = StyleSheet.create({
  container: { flexDirection: "row", alignItems: "center", gap: 10 },
  statsContainer: {
    display: "flex",
    alignItems: "center",
    width: 100,
  },
  label: {
    color: "white",
    marginTop: 10,
    fontSize: 10,
  },
  value: {
    fontSize: 12,
    color: "white",
    fontWeight: "bold",
  },

  percentage: {
    marginTop: 12,
    fontSize: 12,
    color: "white",
    fontWeight: "bold",
    textAlign: "center",
    fontStyle: "italic",
  },
});
